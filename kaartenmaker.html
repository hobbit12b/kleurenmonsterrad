<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <title>2x2 Kleuren Bingo — 25 unieke kaarten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --bg:#f6f7fb; --fg:#222; --paper:#fff; }
    * { box-sizing: border-box; }
    body { margin:0; padding:20px; font-family:system-ui,Arial,sans-serif; background:var(--bg); color:var(--fg); }
    h1 { margin:0 0 12px 0; font-size:22px; }
    .toolbar { display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-bottom:16px; }
    button, select {
      padding:8px 12px; border:0; border-radius:12px; cursor:pointer;
      background:var(--fg); color:#fff; font-size:14px;
    }
    button[disabled]{ opacity:.6; cursor:not-allowed; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(260px, 1fr)); gap:16px; }
    .card { background:var(--paper); border:4px solid var(--fg); border-radius:16px; padding:12px; display:flex; flex-direction:column; align-items:center; gap:8px; }
    .card h2 { font-size:14px; margin:0; }
    canvas.cardcnv { width:100%; height:auto; background:#fff; border-radius:10px; }
    .row { display:flex; gap:10px; align-items:center; }
    a.dl { text-decoration:none; color:#fff; background:#2d6cdf; padding:6px 10px; border-radius:10px; font-size:13px; }
    @media print {
      .toolbar { display:none; }
      body { background:#fff; padding:0; }
      .grid { grid-template-columns:repeat(2, 1fr); gap:0; }
      .card { border:0; page-break-inside:avoid; }
    }
  </style>
</head>
<body>
  <h1>2x2 Kleuren Bingo</h1>
  <div class="toolbar">
    <button id="gen">Genereer 25 unieke kaarten</button>
    <button id="printBtn">Print</button>
    <label>Kleurenset
      <select id="set">
        <option value="les">Bruin, Zilver, Goud, Beige, Turquoise, Zalmroze, Grijs</option>
      </select>
    </label>
  </div>

  <div id="status" aria-live="polite"></div>
  <div id="grid" class="grid"></div>

  <script>
  // --------- data ---------
  const sets = { les: ["Bruin","Zilver","Goud","Beige","Turquoise","Zalmroze","Grijs"] };
  const kleurMap = {
    "Bruin":"#8B4513","Zilver":"#C0C0C0","Goud":"#D4AF37",
    "Beige":"#F5F5DC","Turquoise":"#40E0D0","Zalmroze":"#FFA07A","Grijs":"#bdbdbd"
  };
  const metallic = new Set(["Goud","Zilver"]);

  // --------- assets ---------
  const imgMask  = new Image(); imgMask.src = "monster-mask.png";
  const imgLine  = new Image(); imgLine.src = "monster-line.png";
  const imgPupil = new Image(); imgPupil.src = "monster-pupillen.png"; // niet gebruikt hier
  let assetsOK = false;
  Promise.all([
    new Promise(r => imgMask.onload = r),
    new Promise(r => imgLine.onload = r),
    new Promise(r => imgPupil.onload = r)
  ]).then(() => assetsOK = true);

  // --------- helpers ---------
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
  function supportMode(ctx, mode) {
    const prev = ctx.globalCompositeOperation;
    ctx.globalCompositeOperation = mode;
    const ok = ctx.globalCompositeOperation === mode;
    ctx.globalCompositeOperation = prev;
    return ok;
  }

  // Glans uitsluitend op bestaande pixels van het monster
  function goudZilverGlans(ctx, x, y, w, h, isGoud) {
    ctx.save();
    // Beperk alle volgende pixels tot bestaande alpha van het monster
    ctx.globalCompositeOperation = "source-atop";

    const lg = ctx.createLinearGradient(0, y, 0, y+h);
    if (isGoud) {
      lg.addColorStop(0.00, "rgba(255,250,210,0.70)");
      lg.addColorStop(0.35, "rgba(255,255,255,0.18)");
      lg.addColorStop(0.60, "rgba(0,0,0,0.36)");
      lg.addColorStop(1.00, "rgba(120,90,0,0.30)");
    } else {
      lg.addColorStop(0.00, "rgba(255,255,255,0.70)");
      lg.addColorStop(0.50, "rgba(0,0,0,0.36)");
      lg.addColorStop(1.00, "rgba(235,235,235,0.32)");
    }

    // Basissluier
    if (supportMode(ctx,"overlay")) {
      ctx.globalCompositeOperation = "overlay";
      ctx.fillStyle = lg; ctx.fillRect(x,y,w,h);
    } else {
      ctx.globalCompositeOperation = "multiply";
      ctx.fillStyle = lg; ctx.fillRect(x,y,w,h);
      ctx.globalCompositeOperation = "lighter";
      ctx.fillStyle = "rgba(255,255,255,0.18)"; ctx.fillRect(x,y,w,h);
    }

    // Highlights
    if (supportMode(ctx,"screen")) {
      ctx.globalCompositeOperation = "screen";
      const r = Math.max(w,h)*0.7;
      const rg = ctx.createRadialGradient(x+w*0.25, y+h*0.22, 0, x+w*0.25, y+h*0.22, r);
      rg.addColorStop(0,"rgba(255,255,255,1)");
      rg.addColorStop(0.35,"rgba(255,255,255,0.55)");
      rg.addColorStop(1,"rgba(255,255,255,0)");
      ctx.fillStyle = rg; ctx.fillRect(x,y,w,h);
    } else {
      ctx.globalAlpha = 0.6;
      ctx.fillStyle = "rgba(255,255,255,0.5)";
      ctx.fillRect(x, y, w, h/3);
      ctx.globalAlpha = 1;
    }
    ctx.restore();
  }

  // teken 1 cel in offscreen canvas en plak in kaart
  function renderCelTo(ctxMain, kleurNaam, rect) {
    const {x,y,w,h} = rect;
    const off = document.createElement("canvas");
    off.width = w; off.height = h;
    const c = off.getContext("2d");

    // vulling
    c.fillStyle = kleurMap[kleurNaam] || "#000";
    c.fillRect(0, 0, w, h);

    // masker
    c.globalCompositeOperation = "destination-in";
    const r = Math.min(w / imgMask.width, h / imgMask.height);
    const mw = Math.round(imgMask.width * r);
    const mh = Math.round(imgMask.height * r);
    const mx = Math.round((w - mw)/2);
    const my = Math.round((h - mh)/2);
    c.drawImage(imgMask, mx, my, mw, mh);
    c.globalCompositeOperation = "source-over";

    // glans uitsluitend binnen de bestaande vorm
    if (metallic.has(kleurNaam)) {
      goudZilverGlans(c, 0, 0, w, h, kleurNaam==="Goud");
    }

    // lijnen
    c.drawImage(imgLine, mx, my, mw, mh);

    // plak in kaart
    ctxMain.drawImage(off, x, y);

    // label
    ctxMain.fillStyle = "#111";
    ctxMain.font = "bold 16px system-ui, Arial";
    ctxMain.textAlign = "center";
    ctxMain.fillText(kleurNaam, x + w/2, y + h - 8);
  }

  // alle 4-combinaties (n choose 4)
  function combos4(arr) {
    const res = [];
    for (let i=0;i<arr.length;i++)
      for (let j=i+1;j<arr.length;j++)
        for (let k=j+1;k<arr.length;k++)
          for (let l=k+1;l<arr.length;l++) res.push([arr[i],arr[j],arr[k],arr[l]]);
    return res;
  }

  // diagonaal plaatsen als goud en zilver samen voorkomen
  function plaats2x2(k4) {
    const hasG = k4.includes("Goud");
    const hasZ = k4.includes("Zilver");
    const rest = k4.filter(k => k!=="Goud" && k!=="Zilver");
    if (hasG && hasZ) return ["Goud", rest[0], rest[1], "Zilver"];
    return shuffle([...k4]);
  }

  // teken één kaart
  function tekenKaart(canvas, kleuren, index) {
    const ctx = canvas.getContext("2d");
    const W = canvas.width = 600, H = canvas.height = 800;
    ctx.clearRect(0,0,W,H);

    // kader
    ctx.fillStyle="#fff"; ctx.fillRect(0,0,W,H);
    ctx.lineWidth=6; ctx.strokeStyle="#222"; ctx.strokeRect(6,6,W-12,H-12);

    // titel
    ctx.fillStyle="#222"; ctx.font="bold 18px system-ui, Arial"; ctx.textAlign="left";
    ctx.fillText(`Kleuren Bingo kaart ${index+1}`, 16, 30);

    // raster 2x2
    const pad = 16, gridX=16, gridY=44;
    const gridW = W - gridX*2, gridH = H - gridY - 16;
    const celW = Math.floor((gridW - pad)/2), celH = Math.floor((gridH - pad)/2);

    const rects = [
      {x:gridX,            y:gridY,            w:celW, h:celH},
      {x:gridX + celW+pad, y:gridY,            w:celW, h:celH},
      {x:gridX,            y:gridY + celH+pad, w:celW, h:celH},
      {x:gridX + celW+pad, y:gridY + celH+pad, w:celW, h:celH}
    ];

    // cel panelen
    ctx.lineWidth = 2; ctx.strokeStyle = "#222";
    rects.forEach(r => { ctx.beginPath(); ctx.roundRect(r.x, r.y, r.w, r.h, 12); ctx.fillStyle="#ffffff"; ctx.fill(); ctx.stroke(); });

    // monsters
    const order = plaats2x2(kleuren);
    for (let i=0;i<4;i++) renderCelTo(ctx, order[i], {x:rects[i].x+8, y:rects[i].y+8, w:rects[i].w-16, h:rects[i].h-16});
  }

  // 25 unieke kaarten (combinaties zonder herhaling)
  function bouwUnieke25(kleuren) {
    const alle = combos4(kleuren); // 35 bij 7 kleuren
    shuffle(alle);
    return alle.slice(0,25);
  }

  // --------- UI ---------
  const grid = document.getElementById("grid");
  const status = document.getElementById("status");

  document.getElementById("gen").addEventListener("click", async () => {
    const setKey = document.getElementById("set").value;
    const kleuren = sets[setKey];

    status.textContent = "Bezig met genereren…";
    await new Promise(r => setTimeout(r, 0));

    if (!assetsOK) {
      await Promise.all([
        new Promise(r => imgMask.complete ? r() : imgMask.onload = r),
        new Promise(r => imgLine.complete ? r() : imgLine.onload = r),
        new Promise(r => imgPupil.complete ? r() : imgPupil.onload = r)
      ]);
    }

    const pakket = bouwUnieke25(kleuren);
    grid.innerHTML = "";
    pakket.forEach((k4, idx) => {
      const wrap = document.createElement("div");
      wrap.className = "card";
      const h2 = document.createElement("h2");
      h2.textContent = `Kaart ${idx+1}`;
      const cnv = document.createElement("canvas");
      cnv.className = "cardcnv";
      const row = document.createElement("div"); row.className = "row";
      const dl = document.createElement("a"); dl.className="dl"; dl.href="#"; dl.textContent="Download PNG";
      dl.addEventListener("click", e => { e.preventDefault(); dl.href = cnv.toDataURL("image/png"); dl.download = `kaart-${idx+1}.png`; });
      wrap.appendChild(h2); wrap.appendChild(cnv); row.appendChild(dl); wrap.appendChild(row); grid.appendChild(wrap);
      tekenKaart(cnv, k4, idx);
    });

    status.textContent = `Klaar, ${pakket.length} unieke kaarten`;
  });

  document.getElementById("printBtn").addEventListener("click", () => window.print());
  </script>
</body>
</html>
