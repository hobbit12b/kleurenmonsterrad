<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <title>3 bij 3 Kleuren Bingo unieke kaarten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --bg:#f6f7fb; --fg:#222; --paper:#fff; }
    * { box-sizing: border-box; }
    body { margin:0; padding:20px; font-family:system-ui,Arial,sans-serif; background:var(--bg); color:var(--fg); }
    h1 { margin:0 0 12px 0; font-size:22px; }
    .toolbar { display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-bottom:16px; }
    .toolbar input[type="number"]{ width:80px; padding:8px 10px; border:2px solid var(--fg); border-radius:10px; background:#fff; color:#111; }
    .toolbar label { display:flex; gap:8px; align-items:center; }
    button {
      padding:8px 12px; border:0; border-radius:12px; cursor:pointer;
      background:var(--fg); color:#fff; font-size:14px;
    }
    button[disabled]{ opacity:.6; cursor:not-allowed; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(260px, 1fr)); gap:16px; }
    .card { background:var(--paper); border:4px solid var(--fg); border-radius:16px; padding:12px; display:flex; flex-direction:column; align-items:center; gap:8px; }
    .card h2 { font-size:14px; margin:0; }
    canvas.cardcnv { width:100%; height:auto; background:#fff; border-radius:10px; }
    .row { display:flex; gap:10px; align-items:center; }
    a.dl { text-decoration:none; color:#fff; background:#2d6cdf; padding:6px 10px; border-radius:10px; font-size:13px; }
    @media print {
      .toolbar { display:none; }
      body { background:#fff; padding:0; }
      .grid { grid-template-columns:repeat(2, 1fr); gap:0; }
      .card { border:0; page-break-inside:avoid; }
    }
  </style>
</head>
<body>
  <h1>3 bij 3 Kleuren Bingo</h1>
  <div class="toolbar">
    <button id="gen">Genereer kaarten</button>
    <label>Aantal
      <input id="aantal" type="number" min="1" max="50" value="25">
    </label>
    <button id="printBtn">Print</button>
    <label>
      <input type="checkbox" id="labelsToggle">
      Namen in de vakjes
    </label>
    <label>
      <input type="checkbox" id="voiceToggle" checked>
      Uitspraak bij klikken
    </label>
    <button id="testTurq">Test turquoise</button>
  </div>

  <div id="status" aria-live="polite"></div>
  <div id="grid" class="grid"></div>

  <script>
  // ---------------- kleurenlijst ----------------
  const PAL = [
    "Bruin","Zilver","Goud","Beige","Turquoise","Zalmroze","Grijs",
    "Wit","Zwart","Blauw","Roze","Paars","Rood","Groen","Geel","Oranje"
  ];

  const kleurMap = {
    "Bruin":"#8B4513","Zilver":"#C0C0C0","Goud":"#D4AF37","Beige":"#F5F5DC","Turquoise":"#40E0D0","Zalmroze":"#FFA07A","Grijs":"#bdbdbd",
    "Wit":"#ffffff","Zwart":"#000000","Blauw":"#1e3a8a","Roze":"#ff9acb","Paars":"#8b5cf6","Rood":"#ef4444","Groen":"#16a34a","Geel":"#fde047","Oranje":"#fb923c"
  };
  const metallic = new Set(["Goud","Zilver"]);
  const witteLijnen = new Set(["Zwart"]);
  const pupillenKleuren = new Set(["Zwart"]); // Zwart krijgt pupillen

  // ---------------- assets ----------------
  const imgMask  = new Image(); imgMask.src  = "monster-mask.png";
  const imgLine  = new Image(); imgLine.src  = "monster-line.png";
  const imgPupil = new Image(); imgPupil.src = "monster-pupillen.png";

  let assetsOK = false;
  Promise.all([
    new Promise(r => imgMask.onload  = r),
    new Promise(r => imgLine.onload  = r),
    new Promise(r => imgPupil.onload = r)
  ]).then(() => assetsOK = true);

  // ---------------- spraak ----------------
  let nlVoice = null;
  function pickVoices() {
    try {
      const voices = window.speechSynthesis ? speechSynthesis.getVoices() : [];
      nlVoice = voices.find(v => v.lang && v.lang.toLowerCase().startsWith("nl")) || null;
    } catch { nlVoice = null; }
  }
  if ("speechSynthesis" in window) {
    pickVoices();
    speechSynthesis.onvoiceschanged = pickVoices;
  }

  function spreekEenmaal(text, rate = 1.0) {
    if (!("speechSynthesis" in window)) return;
    try {
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      if (nlVoice) u.voice = nlVoice;
      u.lang = nlVoice?.lang || "nl-NL";
      u.rate = rate;
      u.pitch = 1.0;
      u.volume = 1.0;
      speechSynthesis.speak(u);
    } catch {}
  }

  // correcte uitspraak, turquoise als thurkwáazùh
  function spreekKleur(naam) {
    const aan = document.getElementById("voiceToggle")?.checked;
    if (!aan) return;
    const key = String(naam || "").toLowerCase();
    if (key === "turquoise") { spreekEenmaal("thurkwáazùh", 0.98); return; }
    spreekEenmaal(naam, 1.0);
  }

  document.getElementById("testTurq").addEventListener("click", () => spreekKleur("Turquoise"));

  // ---------------- util ----------------
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
  function kies9Uniek(){ const k=[...PAL]; shuffle(k); return k.slice(0,9); }
  function signatuur(a){ return a.join("|"); }

  // goud en zilver diagonaal zodat ze geen buren zijn
  function plaats3x3(list){
    const diag = [[0,8],[2,6]];
    const g = Array(9).fill(null);
    const heeftG = list.includes("Goud");
    const heeftZ = list.includes("Zilver");
    const rest = list.filter(x => x!=="Goud" && x!=="Zilver");
    if (heeftG && heeftZ){
      const d = diag[Math.floor(Math.random()*diag.length)];
      g[d[0]]="Goud"; g[d[1]]="Zilver";
      shuffle(rest);
      let i=0; for(let p=0;p<9;p++) if(g[p]==null) g[p]=rest[i++];
      return g;
    }
    return shuffle([...list]);
  }

  // ---------------- glans overlay, hard gemaskeerd ----------------
  function metallicOverlayMasked(w,h,isGoud,mx,my,mw,mh){
    const ov = document.createElement("canvas"); ov.width=w; ov.height=h;
    const o = ov.getContext("2d");

    const lg = o.createLinearGradient(0,0,0,h);
    if(isGoud){
      lg.addColorStop(0.00,"rgba(255,253,220,0.95)");
      lg.addColorStop(0.22,"rgba(255,255,255,0.35)");
      lg.addColorStop(0.55,"rgba(0,0,0,0.55)");
      lg.addColorStop(1.00,"rgba(110,80,0,0.45)");
    }else{
      lg.addColorStop(0.00,"rgba(255,255,255,0.95)");
      lg.addColorStop(0.40,"rgba(0,0,0,0.55)");
      lg.addColorStop(1.00,"rgba(235,235,235,0.50)");
    }
    o.fillStyle=lg; o.fillRect(0,0,w,h);

    o.save(); o.translate(w/2,h/2); o.rotate(-Math.PI/8); o.translate(-w/2,-h/2);
    o.globalAlpha=0.9;
    for(let i=0;i<4;i++){
      const y0=h*0.12+i*h*0.22;
      const g=o.createLinearGradient(0,y0,w,y0);
      g.addColorStop(0,"rgba(255,255,255,0)");
      g.addColorStop(0.5,"rgba(255,255,255,1)");
      g.addColorStop(1,"rgba(255,255,255,0)");
      o.fillStyle=g; o.fillRect(0,y0-h*0.06,w,h*0.12);
    }
    o.restore();

    const rg1=o.createRadialGradient(w*0.22,h*0.18,0,w*0.22,h*0.18,Math.max(w,h)*0.75);
    rg1.addColorStop(0,"rgba(255,255,255,1)");
    rg1.addColorStop(0.35,"rgba(255,255,255,0.65)");
    rg1.addColorStop(1,"rgba(255,255,255,0)");
    o.fillStyle=rg1; o.fillRect(0,0,w,h);

    const rg2=o.createRadialGradient(w*0.78,h*0.82,0,w*0.78,h*0.82,Math.max(w,h)*0.45);
    rg2.addColorStop(0,"rgba(255,255,255,0.85)");
    rg2.addColorStop(0.4,"rgba(255,255,255,0.45)");
    rg2.addColorStop(1,"rgba(255,255,255,0)");
    o.fillStyle=rg2; o.fillRect(0,0,w,h);

    // masker
    o.globalCompositeOperation="destination-in";
    o.drawImage(imgMask,mx,my,mw,mh);
    o.globalCompositeOperation="source-over";
    return ov;
  }

  // ---------------- één cel tekenen ----------------
  function renderCelTo(ctxMain, naam, rect, toonLabel){
    const {x,y,w,h}=rect;
    const off=document.createElement("canvas"); off.width=w; off.height=h;
    const c=off.getContext("2d");

    // vulling
    c.fillStyle=kleurMap[naam]||"#000";
    c.fillRect(0,0,w,h);

    // positionering masker en lagen
    const r=Math.min(w/imgMask.width,h/imgMask.height);
    const mw=Math.round(imgMask.width*r);
    const mh=Math.round(imgMask.height*r);
    const mx=Math.round((w-mw)/2);
    const my=Math.round((h-mh)/2);

    // clip tot monster
    c.globalCompositeOperation="destination-in";
    c.drawImage(imgMask,mx,my,mw,mh);
    c.globalCompositeOperation="source-over";

    // metaalglans
    if(metallic.has(naam)){
      const ov=metallicOverlayMasked(w,h,naam==="Goud",mx,my,mw,mh);
      c.save();
      c.globalCompositeOperation="multiply"; c.globalAlpha=0.95; c.drawImage(ov,0,0);
      c.globalCompositeOperation="screen";   c.globalAlpha=0.95; c.drawImage(ov,0,0);
      c.globalCompositeOperation="overlay";  c.globalAlpha=0.70; c.drawImage(ov,0,0);
      c.restore();
    }

    // speciaal voor Zwart: wit oogveld onder de pupillen
    if(naam==="Zwart"){
      const eyes=document.createElement("canvas");
      eyes.width=mw; eyes.height=mh;
      const ec=eyes.getContext("2d");
      ec.drawImage(imgPupil,0,0,mw,mh);
      ec.globalCompositeOperation="source-in";
      ec.fillStyle="#ffffff";
      ec.fillRect(0,0,mw,mh);
      ec.filter="blur(2.5px)";
      c.drawImage(eyes,mx,my);
      ec.filter="none";
      ec.globalCompositeOperation="source-over";
    }

    // lijnen
    if(witteLijnen.has(naam)){
      const tint=document.createElement("canvas");
      tint.width=mw; tint.height=mh;
      const tc=tint.getContext("2d");
      tc.fillStyle="#ffffff"; tc.fillRect(0,0,mw,mh);
      tc.globalCompositeOperation="destination-in";
      tc.drawImage(imgLine,0,0,mw,mh);
      tc.globalCompositeOperation="source-over";
      c.drawImage(tint,mx,my);
    }else{
      c.drawImage(imgLine,mx,my,mw,mh);
    }

    // pupillen erbovenop waar gewenst
    if(pupillenKleuren.has(naam)){
      c.globalCompositeOperation="source-over";
      c.globalAlpha=1;
      c.drawImage(imgPupil,mx,my,mw,mh);
    }

    // naar kaart
    ctxMain.drawImage(off,x,y);

    if(toonLabel){
      ctxMain.fillStyle="#111";
      ctxMain.font="bold 12px system-ui, Arial";
      ctxMain.textAlign="center";
      ctxMain.fillText(naam,x+w/2,y+h-6);
    }
  }

  // ---------------- kaart tekenen ----------------
  function tekenKaart(canvas, volgorde9, index, toonLabel){
    const ctx=canvas.getContext("2d");
    const W=canvas.width=600, H=canvas.height=800;
    ctx.clearRect(0,0,W,H);

    ctx.fillStyle="#fff"; ctx.fillRect(0,0,W,H);
    ctx.lineWidth=6; ctx.strokeStyle="#222"; ctx.strokeRect(6,6,W-12,H-12);

    ctx.fillStyle="#222"; ctx.font="bold 18px system-ui, Arial"; ctx.textAlign="left";
    ctx.fillText(`Kleuren Bingo kaart ${index+1}`,16,30);

    const pad=14, gridX=16, gridY=44;
    const gridW=W-gridX*2, gridH=H-gridY-16;
    const celW=Math.floor((gridW-pad*2)/3), celH=Math.floor((gridH-pad*2)/3);

    // panelen
    ctx.lineWidth=2; ctx.strokeStyle="#222";
    for(let r=0;r<3;r++){
      for(let c=0;c<3;c++){
        const x=gridX+c*(celW+pad);
        const y=gridY+r*(celH+pad);
        ctx.beginPath(); ctx.roundRect(x,y,celW,celH,12); ctx.fillStyle="#ffffff"; ctx.fill(); ctx.stroke();
        const kleurNaam = volgorde9[r*3+c];
        renderCelTo(ctx, kleurNaam, {x:x+8,y:y+8,w:celW-16,h:celH-16}, toonLabel);
      }
    }

    // sla de volgorde op voor klik uitspraak
    canvas.dataset.colors = volgorde9.join("|");
 
