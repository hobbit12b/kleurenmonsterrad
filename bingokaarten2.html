<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <title>9x9 Kleuren Bingo — unieke kaarten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --bg:#f6f7fb; --fg:#222; --paper:#fff; }
    * { box-sizing: border-box; }
    body { margin:0; padding:20px; font-family:system-ui,Arial,sans-serif; background:var(--bg); color:var(--fg); }
    h1 { margin:0 0 12px 0; font-size:22px; }
    .toolbar { display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-bottom:16px; }
    .toolbar input[type="number"]{ width:80px; padding:8px 10px; border:2px solid var(--fg); border-radius:10px; background:#fff; color:#111; }
    button, select {
      padding:8px 12px; border:0; border-radius:12px; cursor:pointer;
      background:var(--fg); color:#fff; font-size:14px;
    }
    button[disabled]{ opacity:.6; cursor:not-allowed; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(320px, 1fr)); gap:16px; }
    .card { background:var(--paper); border:4px solid var(--fg); border-radius:16px; padding:12px; display:flex; flex-direction:column; align-items:center; gap:8px; }
    .card h2 { font-size:14px; margin:0; }
    canvas.cardcnv { width:100%; height:auto; background:#fff; border-radius:10px; }
    .row { display:flex; gap:10px; align-items:center; }
    a.dl { text-decoration:none; color:#fff; background:#2d6cdf; padding:6px 10px; border-radius:10px; font-size:13px; }
    label small { font-size:12px; opacity:.75; }
    @media print {
      .toolbar { display:none; }
      body { background:#fff; padding:0; }
      .grid { grid-template-columns:repeat(2, 1fr); gap:0; }
      .card { border:0; page-break-inside:avoid; }
    }
  </style>
</head>
<body>
  <h1>9x9 Kleuren Bingo</h1>
  <div class="toolbar">
    <button id="gen">Genereer kaarten</button>
    <label>Aantal
      <input id="aantal" type="number" min="1" max="50" value="25">
    </label>
    <button id="printBtn">Print</button>
    <label>
      <input type="checkbox" id="labelsToggle">
      Namen in de vakjes <small>(uit)</small>
    </label>
  </div>

  <div id="status" aria-live="polite"></div>
  <div id="grid" class="grid"></div>

  <script>
  // ---------- kleuren ----------
  // Leskleuren, krijgen een zwaarder gewicht
  const lesKleuren = ["Bruin","Zilver","Goud","Beige","Turquoise","Zalmroze","Grijs"];

  // Aanvulling, exact zoals je vroeg
  const extraKleuren = [
    "Wit","Grijs","Zwart","Lichtblauw","Donkerblauw","Roze","Paars",
    "Rood","Lichtgroen","Donkergroen","Geel","Oranje"
  ];

  // Unieke samengestelde set, geen dubbele namen
  const alleKleuren = Array.from(new Set([...lesKleuren, ...extraKleuren]));

  const kleurMap = {
    // les
    "Bruin":"#8B4513","Zilver":"#C0C0C0","Goud":"#D4AF37","Beige":"#F5F5DC","Turquoise":"#40E0D0","Zalmroze":"#FFA07A","Grijs":"#bdbdbd",
    // extra
    "Wit":"#ffffff","Zwart":"#000000","Lichtblauw":"#87cefa","Donkerblauw":"#1e3a8a","Roze":"#ff9acb","Paars":"#8b5cf6",
    "Rood":"#ef4444","Lichtgroen":"#86efac","Donkergroen":"#166534","Geel":"#fde047","Oranje":"#fb923c"
  };

  // Gewicht, leskleuren tellen zwaarder zodat ze vaker voorkomen
  const gewicht = {};
  alleKleuren.forEach(k => { gewicht[k] = lesKleuren.includes(k) ? 3 : 1; });

  // Lijnkleur wit op zwart voor zichtbaarheid
  const lijnWitSet = new Set(["Zwart"]);

  // Glans op metaal
  const metallic = new Set(["Goud","Zilver"]);

  // ---------- assets ----------
  const imgMask  = new Image(); imgMask.src = "monster-mask.png";
  const imgLine  = new Image(); imgLine.src = "monster-line.png";
  const imgPupil = new Image(); imgPupil.src = "monster-pupillen.png"; // niet gebruikt hier

  let assetsOK = false;
  Promise.all([
    new Promise(r => imgMask.onload = r),
    new Promise(r => imgLine.onload = r),
    new Promise(r => imgPupil.onload = r)
  ]).then(() => assetsOK = true);

  // ---------- helpers ----------
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

  // gewogen keuze uit toegestane set
  function kiesGewogen(toegelaten) {
    let total = 0;
    for (const k of toegelaten) total += (gewicht[k] || 1);
    let r = Math.random() * total;
    for (const k of toegelaten) {
      r -= (gewicht[k] || 1);
      if (r <= 0) return k;
    }
    return toegelaten[0];
  }

  // geen Goud naast Zilver, links rechts boven onder
  function burenOk(grid, r, c, kleur) {
    const h = grid.length, w = grid[0].length;
    const isMetaal = x => x==="Goud" || x==="Zilver";
    const conflict = (a, b) => (a==="Goud" && b==="Zilver") || (a==="Zilver" && b==="Goud");
    const check = (rr, cc) => rr>=0 && rr<h && cc>=0 && cc<w && grid[rr][cc] !== null && conflict(grid[rr][cc], kleur);
    if (check(r, c-1)) return false; // links
    if (check(r-1, c)) return false; // boven
    return true;
  }

  // bouw één 9 bij 9 raster volgens gewichten, zonder Goud naast Zilver
  function maakRaster9x9() {
    const H = 9, W = 9;
    const grid = Array.from({length:H}, () => Array(W).fill(null));
    for (let r=0; r<H; r++) {
      for (let c=0; c<W; c++) {
        // start met alle kleuren
        let opties = [...alleKleuren];
        // filter die direct conflict zouden geven
        opties = opties.filter(k => burenOk(grid, r, c, k));
        // als door filtering niets overblijft, laat dan alle kleuren toe
        if (opties.length === 0) opties = [...alleKleuren];
        // kies gewogen
        grid[r][c] = kiesGewogen(opties);
      }
    }
    return grid.flat();
  }

  // handtekening voor uniekheid
  function signatuur(arr) { return arr.join("|"); }

  // glans op apart overlay canvas, hard gemaskeerd met het monster
  function metallicOverlayMasked(w, h, isGoud, maskX, maskY, maskW, maskH) {
    const ov = document.createElement("canvas");
    ov.width = w; ov.height = h;
    const o = ov.getContext("2d");

    // basis verloop
    const lg = o.createLinearGradient(0, 0, 0, h);
    if (isGoud) {
      lg.addColorStop(0.00, "rgba(255,250,210,0.70)");
      lg.addColorStop(0.35, "rgba(255,255,255,0.18)");
      lg.addColorStop(0.60, "rgba(0,0,0,0.36)");
      lg.addColorStop(1.00, "rgba(120,90,0,0.30)");
    } else {
      lg.addColorStop(0.00, "rgba(255,255,255,0.70)");
      lg.addColorStop(0.50, "rgba(0,0,0,0.36)");
      lg.addColorStop(1.00, "rgba(235,235,235,0.32)");
    }
    o.fillStyle = lg; o.fillRect(0,0,w,h);

    // glansstrepen
    o.save();
    o.translate(w/2, h/2);
    o.rotate(-Math.PI/10);
    o.translate(-w/2, -h/2);
    o.globalAlpha = 0.55;
    for (let i=0;i<3;i++) {
      const gy = h*0.10 + i*h*0.25;
      const g = o.createLinearGradient(0, gy, w, gy);
      g.addColorStop(0, "rgba(255,255,255,0)");
      g.addColorStop(0.5, "rgba(255,255,255,0.95)");
      g.addColorStop(1, "rgba(255,255,255,0)");
      o.fillStyle = g; o.fillRect(0, gy - h*0.05, w, h*0.10);
    }
    o.restore(); o.globalAlpha = 1;

    // highlights
    const rg = o.createRadialGradient(w*0.20, h*0.18, 0, w*0.20, h*0.18, Math.max(w,h)*0.7);
    rg.addColorStop(0, "rgba(255,255,255,1.00)");
    rg.addColorStop(0.35, "rgba(255,255,255,0.55)");
    rg.addColorStop(1, "rgba(255,255,255,0.00)");
    o.fillStyle = rg; o.fillRect(0,0,w,h);

    // hard maskeren
    o.globalCompositeOperation = "destination-in";
    o.drawImage(imgMask, maskX, maskY, maskW, maskH);
    o.globalCompositeOperation = "source-over";

    return ov;
  }

  // render één cel in offscreen canvas, plak daarna
  function renderCelTo(ctxMain, kleurNaam, rect, toonLabel) {
    const {x,y,w,h} = rect;
    const c = document.createElement("canvas");
    c.width = w; c.height = h;
    const cc = c.getContext("2d");

    // vulling
    cc.fillStyle = kleurMap[kleurNaam] || "#000";
    cc.fillRect(0, 0, w, h);

    // maskerplaatsing
    const r = Math.min(w / imgMask.width, h / imgMask.height);
    const mw = Math.round(imgMask.width * r);
    const mh = Math.round(imgMask.height * r);
    const mx = Math.round((w - mw)/2);
    const my = Math.round((h - mh)/2);

    // masker toepassen
    cc.globalCompositeOperation = "destination-in";
    cc.drawImage(imgMask, mx, my, mw, mh);
    cc.globalCompositeOperation = "source-over";

    // glans alleen voor metaal
    if (metallic.has(kleurNaam)) {
      const ov = metallicOverlayMasked(w, h, kleurNaam==="Goud", mx, my, mw, mh);
      cc.drawImage(ov, 0, 0);
    }

    // lijnenlaag
    if (lijnWitSet.has(kleurNaam)) {
      // witte lijnen voor Zwart
      const tint = document.createElement("canvas");
      tint.width = mw; tint.height = mh;
      const tc = tint.getContext("2d");
      tc.fillStyle = "#ffffff";
      tc.fillRect(0, 0, mw, mh);
      tc.globalCompositeOperation = "destination-in";
      tc.drawImage(imgLine, 0, 0, mw, mh);
      tc.globalCompositeOperation = "source-over";
      cc.drawImage(tint, mx, my);
    } else {
      cc.drawImage(imgLine, mx, my, mw, mh);
    }

    // naar kaart plakken
    ctxMain.drawImage(c, x, y);

    // label optioneel
    if (toonLabel) {
      ctxMain.fillStyle = "#111";
      ctxMain.font = "bold 10px system-ui, Arial";
      ctxMain.textAlign = "center";
      ctxMain.fillText(kleurNaam, x + w/2, y + h - 6);
    }
  }

  // teken één kaart
  function tekenKaart(canvas, kleuren81, index, toonLabel) {
    const ctx = canvas.getContext("2d");
    // Iets groter canvas voor scherpe print
    const W = canvas.width = 1200, H = canvas.height = 1600;
    ctx.clearRect(0,0,W,H);

    // kader
    ctx.fillStyle="#fff"; ctx.fillRect(0,0,W,H);
    ctx.lineWidth=6; ctx.strokeStyle="#222"; ctx.strokeRect(6,6,W-12,H-12);

    // titel
    ctx.fillStyle="#222"; ctx.font="bold 22px system-ui, Arial"; ctx.textAlign="left";
    ctx.fillText(`Kleuren Bingo kaart ${index+1}`, 24, 42);

    // raster 9 bij 9
    const pad = 8, gridX=24, gridY=60;
    const gridW = W - gridX*2, gridH = H - gridY - 24;
    const celW = Math.floor((gridW - pad*8)/9), celH = Math.floor((gridH - pad*8)/9);

    const rects = [];
    for (let r=0;r<9;r++){
      for (let c=0;c<9;c++){
        const x = gridX + c*(celW + pad);
        const y = gridY + r*(celH + pad);
        rects.push({x, y, w:celW, h:celH});
      }
    }

    // panelen
    ctx.lineWidth = 2; ctx.strokeStyle = "#222";
    rects.forEach(r => { ctx.beginPath(); ctx.roundRect(r.x, r.y, r.w, r.h, 10); ctx.fillStyle="#ffffff"; ctx.fill(); ctx.stroke(); });

    // monsters
    for (let i=0;i<81;i++) {
      const r = rects[i];
      renderCelTo(ctx, kleuren81[i], {x:r.x+4, y:r.y+4, w:r.w-8, h:r.h-8}, toonLabel);
    }
  }

  // bouw N unieke kaarten
  function bouwUniekeKaarten(n) {
    const set = new Set();
    const lijst = [];
    let guard = 0;
    while (lijst.length < n && guard < n * 200) {
      guard++;
      const c81 = maakRaster9x9();           // 81 kleuren
      const sig = signatuur(c81);
      if (!set.has(sig)) { set.add(sig); lijst.push(c81); }
    }
    return lijst;
  }

  // ---------- UI ----------
  const grid = document.getElementById("grid");
  const status = document.getElementById("status");

  document.getElementById("gen").addEventListener("click", async () => {
    const n = Math.max(1, Math.min(50, parseInt(document.getElementById("aantal").value || "25", 10)));
    const toonLabel = document.getElementById("labelsToggle").checked;

    status.textContent = "Bezig met genereren…";
    await new Promise(r => setTimeout(r, 0));

    if (!assetsOK) {
      await Promise.all([
        new Promise(r => imgMask.complete ? r() : imgMask.onload = r),
        new Promise(r => imgLine.complete ? r() : imgLine.onload = r),
        new Promise(r => imgPupil.complete ? r() : imgPupil.onload = r)
      ]);
    }

    const pakket = bouwUniekeKaarten(n);
    grid.innerHTML = "";
    pakket.forEach((k81, idx) => {
      const wrap = document.createElement("div");
      wrap.className = "card";
      const h2 = document.createElement("h2");
      h2.textContent = `Kaart ${idx+1}`;
      const cnv = document.createElement("canvas");
      cnv.className = "cardcnv";
      const row = document.createElement("div"); row.className = "row";
      const dl = document.createElement("a"); dl.className="dl"; dl.href="#"; dl.textContent="Download PNG";
      dl.addEventListener("click", e => { e.preventDefault(); dl.href = cnv.toDataURL("image/png"); dl.download = `kaart-${idx+1}.png`; });
      wrap.appendChild(h2); wrap.appendChild(cnv); row.appendChild(dl); wrap.appendChild(row); grid.appendChild(wrap);
      tekenKaart(cnv, k81, idx, toonLabel);
    });

    status.textContent = `Klaar, ${pakket.length} unieke kaarten`;
  });

  document.getElementById("printBtn").addEventListener("click", () => window.print());
  </script>
</body>
</html>
