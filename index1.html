<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Kleurenmonster Spinner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#f6f7fb; --fg:#222; --panel:#fff; }
    * { box-sizing: border-box; }
    body {
      display: grid;
      grid-template-columns: 520px 520px;
      gap: 24px;
      justify-content: center;
      align-items: start;
      padding: 20px;
      font-family: system-ui, Arial, sans-serif;
      background: var(--bg);
      color: var(--fg);
    }
    .kolom { display: flex; flex-direction: column; align-items: center; }
    h1 { font-size: 20px; margin: 10px 0; }
    canvas { background: var(--panel); border: 4px solid var(--fg); border-radius: 12px; }
    #rad { width: 500px; height: 400px; }
    button {
      margin-top: 12px; padding: 10px 20px; font-size: 16px;
      border: 0; border-radius: 12px; background: var(--fg); color: #fff; cursor: pointer;
    }
    button[disabled] { opacity: .6; cursor: not-allowed; }
    #resultaat { margin-top: 10px; font-size: 18px; font-weight: 700; min-height: 1.5em; }
    #live { position: absolute; left: -9999px; }
    #debug { margin-top: 6px; font-size: 12px; color: #555; }
  </style>
</head>
<body>
  <div class="kolom">
    <h1>Spinner</h1>
    <canvas id="rad" width="500" height="400" aria-label="kleurenspin"></canvas>
    <button id="draaiBtn" aria-describedby="resultaat">Draai</button>
    <div id="resultaat"></div>
    <div id="live" role="status" aria-live="polite"></div>
    <div id="debug"></div>
  </div>

  <div class="kolom">
    <h1>Kleurenmonster</h1>
    <canvas id="monster" width="400" height="600" aria-label="kleurenmonster"></canvas>
  </div>

  <script>
  // Alles in DOMContentLoaded, geen pijlfuncties
  document.addEventListener("DOMContentLoaded", function () {
    try {
      const opties = ["zalm roze","lila","beige","wit","zilver","goud","turquoise"];
      const kleurMap = {
        "zalm roze":"#FFA07A",
        "lila":"#C8A2C8",
        "beige":"#F5F5DC",
        "wit":"#FFFFFF",
        "zilver":"#C0C0C0",
        "goud":"#D4AF37",
        "turquoise":"#40E0D0"
      };
      const metallicKleuren = new Set(["goud","zilver"]);
      const donkereSegmenten = new Set([]); // zwarte segmenttekst overal
      const lijnenWitKleuren = new Set([]); // nooit witte lijnen bij deze set
      const pupilKleuren = new Set([]);     // geen extra pupillen

      // debug helper
      var dbg = document.getElementById("debug");
      function info(msg){ dbg.textContent = msg; }

      // Spinner
      var rad = document.getElementById("rad");
      var rctx = rad.getContext("2d");
      var CX = 220, CY = 200, R = 190; // rad links, rechts ruimte voor pijl
      var hoek = 0, bezig = false, gekozen = opties[0];

      function tekenSchijven() {
        var stap = 2 * Math.PI / opties.length;
        var i, naam;
        for (i = 0; i < opties.length; i++) {
          naam = opties[i];
          rctx.beginPath();
          rctx.moveTo(CX, CY);
          rctx.arc(CX, CY, R, i * stap, (i + 1) * stap);
          rctx.closePath();
          rctx.fillStyle = kleurMap[naam] || "#000";
          rctx.fill();
          rctx.strokeStyle = "#222";
          rctx.lineWidth = 2;
          rctx.stroke();

          var tekstkleur = donkereSegmenten.has(naam) ? "#fff" : "#000";
          rctx.save();
          rctx.translate(CX, CY);
          rctx.rotate(i * stap + stap / 2);
          rctx.textAlign = "right";
          rctx.fillStyle = tekstkleur;
          rctx.font = "16px system-ui, Arial";
          rctx.fillText(naam, R - 12, 6);
          rctx.restore();
        }
        rctx.lineWidth = 6;
        rctx.strokeStyle = "#333";
        rctx.beginPath();
        rctx.arc(CX, CY, R + 3, 0, Math.PI * 2);
        rctx.stroke();
      }

      function tekenPijl() {
        var offset = 22;
        var tipX = CX + R + offset;
        var tipY = CY;
        var baseX = tipX + 34;
        var halfH = 22;

        rctx.beginPath();
        rctx.moveTo(tipX, tipY);
        rctx.lineTo(baseX, tipY - halfH);
        rctx.lineTo(baseX, tipY + halfH);
        rctx.closePath();
        rctx.fillStyle = "#222";
        rctx.fill();

        rctx.beginPath();
        rctx.arc(CX, CY, 6, 0, Math.PI * 2);
        rctx.fill();
      }

      function renderRad() {
        rctx.clearRect(0, 0, rad.width, rad.height);
        rctx.save();
        rctx.translate(CX, CY);
        rctx.rotate(hoek * Math.PI / 180);
        rctx.translate(-CX, -CY);
        tekenSchijven();
        rctx.restore();
        tekenPijl();
      }

      function indexOnderPijl() {
        var n = opties.length, stap = 360 / n;
        var a = (-hoek) % 360; if (a < 0) a += 360;
        return Math.floor(a / stap) % n;
      }

      function draai() {
        if (bezig) return;
        bezig = true;
        document.getElementById("draaiBtn").disabled = true;
        var snelheid = 20 + Math.random() * 15;
        hoek += 360 * 4;

        function anim() {
          snelheid *= 0.985;
          hoek += snelheid;
          renderRad();
          if (snelheid > 0.25) requestAnimationFrame(anim);
          else {
            hoek = hoek % 360;
            renderRad();
            var idx = indexOnderPijl();
            gekozen = opties[idx];

            var lijnenWit = lijnenWitKleuren.has(gekozen);
            var toonPupillen = pupilKleuren.has(gekozen);
            var metallicType = metallicKleuren.has(gekozen) ? gekozen : null;

            toonResultaat(gekozen);
            kleurMonster(kleurMap[gekozen], lijnenWit, toonPupillen, metallicType);

            bezig = false;
            document.getElementById("draaiBtn").disabled = false;
          }
        }
        requestAnimationFrame(anim);
      }

      function toonResultaat(tekst) {
        document.getElementById("resultaat").textContent = "Gekozen kleur: " + tekst;
        document.getElementById("live").textContent = "Kleur " + tekst;
      }

      // Monster
      var mCanvas = document.getElementById("monster");
      var m = mCanvas.getContext("2d");
      var imgMask  = new Image();  imgMask.src  = "monster-mask.png";
      var imgLine  = new Image();  imgLine.src  = "monster-line.png";
      var imgPupil = new Image();  imgPupil.src = "monster-pupillen.png";

      var geladen = 0;
      function klaar(){ geladen++; if (geladen === 3) initMonster(); }
      function fout(e){ info("Kon een afbeelding niet laden, controleer bestandsnamen, exact, inclusief kleine letters."); }
      imgMask.onload = klaar;   imgMask.onerror = fout;
      imgLine.onload = klaar;   imgLine.onerror = fout;
      imgPupil.onload = klaar;  imgPupil.onerror = fout;

      function initMonster() {
        tekenMonsterKader();
        kleurMonster(kleurMap[gekozen], false, false, null);
      }

      function tekenMonsterKader() {
        m.clearRect(0, 0, mCanvas.width, mCanvas.height);
        m.save();
        m.lineWidth = 6;
        m.strokeStyle = "#222";
        m.fillStyle = "#fff";
        m.beginPath();
        rondeRechthoek(m, 12, 12, mCanvas.width - 24, mCanvas.height - 24, 18);
        m.fill();
        m.stroke();
        m.restore();
      }

      // veilige test op blendmodus, met fallback
      function supportMode(ctx, mode) {
        var prev = ctx.globalCompositeOperation;
        ctx.globalCompositeOperation = mode;
        var ok = (ctx.globalCompositeOperation === mode);
        ctx.globalCompositeOperation = prev;
        return ok;
      }

      // lijnenWit, toonPupillen, metallicType: "goud", "zilver" of null
      function kleurMonster(vulkleur, lijnenWit, toonPupillen, metallicType) {
        tekenMonsterKader();

        var pad = 24;
        var doelW = mCanvas.width - pad * 2;
        var doelH = mCanvas.height - pad * 2;
        var ratio = Math.min(doelW / imgMask.width, doelH / imgMask.height);
        var w = Math.max(1, Math.round(imgMask.width * ratio));
        var h = Math.max(1, Math.round(imgMask.height * ratio));
        var x = Math.round((mCanvas.width - w) / 2);
        var y = Math.round((mCanvas.height - h) / 2);

        // vulling binnen masker
        m.save();
        m.fillStyle = vulkleur;
        m.fillRect(x, y, w, h);
        m.globalCompositeOperation = "destination-in";
        m.imageSmoothingEnabled = true;
        m.drawImage(imgMask, x, y, w, h);
        m.globalCompositeOperation = "source-over";

        // metallic laag onder de lijnen
        if (metallicType) voegMetaalGlansToe(metallicType, x, y, w, h);

        // lijnen
        if (!lijnenWit) {
          m.drawImage(imgLine, x, y, w, h);
        } else {
          var off = document.createElement("canvas");
          off.width = w; off.height = h;
          var o = off.getContext("2d");
          o.imageSmoothingEnabled = true;
          o.fillStyle = "#ffffff";
          o.fillRect(0, 0, off.width, off.height);
          o.globalCompositeOperation = "destination-in";
          o.drawImage(imgLine, 0, 0, off.width, off.height);
          o.globalCompositeOperation = "source-over";
          m.drawImage(off, x, y);
        }

        if (toonPupillen) m.drawImage(imgPupil, x, y, w, h);
        m.restore();
      }

      function voegMetaalGlansToe(type, x, y, w, h) {
        // diepte
        var overlay = document.createElement("canvas");
        overlay.width = w; overlay.height = h;
        var o = overlay.getContext("2d");

        var lg = o.createLinearGradient(0, 0, 0, h);
        if (type === "goud") {
          lg.addColorStop(0.00, "rgba(255,250,210,0.70)");
          lg.addColorStop(0.35, "rgba(255,255,255,0.18)");
          lg.addColorStop(0.60, "rgba(0,0,0,0.36)");
          lg.addColorStop(1.00, "rgba(120,90,0,0.30)");
        } else {
          lg.addColorStop(0.00, "rgba(255,255,255,0.70)");
          lg.addColorStop(0.50, "rgba(0,0,0,0.36)");
          lg.addColorStop(1.00, "rgba(235,235,235,0.32)");
        }
        o.fillStyle = lg;
        o.fillRect(0, 0, w, h);

        // glansstrepen
        o.save();
        o.globalAlpha = 0.55;
        o.translate(w * 0.10, h * 0.18);
        o.rotate(-Math.PI / 10);
        for (var i = 0; i < 3; i++) {
          var g = o.createLinearGradient(0, 0, w * 0.95, 0);
          g.addColorStop(0,   "rgba(255,255,255,0)");
          g.addColorStop(0.5, "rgba(255,255,255,0.95)");
          g.addColorStop(1,   "rgba(255,255,255,0)");
          o.fillStyle = g;
          o.fillRect(0, i * h * 0.08, w * 0.95, h * 0.06);
        }
        o.restore();

        // maskeren tot de vorm
        o.globalCompositeOperation = "destination-in";
        o.drawImage(imgMask, 0, 0, w, h);
        o.globalCompositeOperation = "source-over";

        // overlay met fallback
        m.save();
        if (supportMode(m, "overlay")) {
          m.globalCompositeOperation = "overlay";
          m.drawImage(overlay, x, y);
          m.globalCompositeOperation = "source-over";
        } else {
          // fallback: multiply en daarna lighten
          m.globalCompositeOperation = "multiply";
          m.drawImage(overlay, x, y);
          m.globalCompositeOperation = "lighter";
          m.drawImage(overlay, x, y);
          m.globalCompositeOperation = "source-over";
        }
        m.restore();

        // highlights
        var spec = document.createElement("canvas");
        spec.width = w; spec.height = h;
        var s = spec.getContext("2d");

        var rg = s.createRadialGradient(w * 0.30, h * 0.25, 0, w * 0.30, h * 0.25, Math.max(w, h) * 0.55);
        rg.addColorStop(0.00, "rgba(255,255,255,1.00)");
        rg.addColorStop(0.30, "rgba(255,255,255,0.60)");
        rg.addColorStop(1.00, "rgba(255,255,255,0.00)");
        s.fillStyle = rg;
        s.fillRect(0, 0, w, h);

        var rg2 = s.createRadialGradient(w * 0.70, h * 0.75, 0, w * 0.70, h * 0.75, Math.max(w, h) * 0.25);
        rg2.addColorStop(0.00, "rgba(255,255,255,0.85)");
        rg2.addColorStop(0.40, "rgba(255,255,255,0.35)");
        rg2.addColorStop(1.00, "rgba(255,255,255,0.00)");
        s.fillStyle = rg2;
        s.fillRect(0, 0, w, h);

        s.globalCompositeOperation = "destination-in";
        s.drawImage(imgMask, 0, 0, w, h);
        s.globalCompositeOperation = "source-over";

        m.save();
        if (supportMode(m, "screen")) {
          m.globalCompositeOperation = "screen";
          m.drawImage(spec, x, y);
          m.globalCompositeOperation = "source-over";
        } else {
          m.globalAlpha = 0.6;
          m.drawImage(spec, x, y);
          m.globalAlpha = 1;
        }
        m.restore();

        // heel lichte ruis voor textuur
        var noise = document.createElement("canvas");
        var nz = 64;
        noise.width = nz; noise.height = nz;
        var nc = noise.getContext("2d");
        var img = nc.createImageData(nz, nz);
        for (var p = 0; p < img.data.length; p += 4) {
          var v = 210 + Math.floor(Math.random() * 45);
          img.data[p] = v; img.data[p+1] = v; img.data[p+2] = v; img.data[p+3] = 28;
        }
        nc.putImageData(img, 0, 0);
        var tex = document.createElement("canvas");
        tex.width = w; tex.height = h;
        var tx = tex.getContext("2d");
        tx.fillStyle = tx.createPattern(noise, "repeat");
        tx.fillRect(0, 0, w, h);
        tx.globalCompositeOperation = "destination-in";
        tx.drawImage(imgMask, 0, 0, w, h);

        m.save();
        if (supportMode(m, "soft-light")) {
          m.globalCompositeOperation = "soft-light";
          m.drawImage(tex, x, y);
          m.globalCompositeOperation = "source-over";
        } else {
          m.globalAlpha = 0.5;
          m.drawImage(tex, x, y);
          m.globalAlpha = 1;
        }
        m.restore();
      }

      function rondeRechthoek(ctx, x, y, w, h, r) {
        ctx.moveTo(x + r, y);
        ctx.lineTo(x + w - r, y);
        ctx.quadraticCurveTo(x + w, y, x + w, y + r);
        ctx.lineTo(x + w, y + h - r);
        ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
        ctx.lineTo(x + r, y + h);
        ctx.quadraticCurveTo(x, y + h, x, y + h - r);
        ctx.lineTo(x, y + r);
        ctx.quadraticCurveTo(x, y, x + r, y);
      }

      // init
      document.getElementById("draaiBtn").addEventListener("click", draai);
      document.addEventListener("keydown", function (e) {
        if ((e.key === "Enter" || e.code === "Space") && !bezig) draai();
      });
      renderRad();
      info("Gereed, als je niets ziet, controleer bestandsnamen en forceer een refresh.");
    } catch (err) {
      document.getElementById("debug").textContent = "Fout: " + err.message;
    }
  });
  </script>
</body>
</html>
